<!DOCTYPE html>
<html lang="en" xmlns:https="http://www.w3.org/1999/xhtml">
<head>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="{{url_for ('static', filename='js/bootpag.js') }}"></script>
    <meta charset="UTF-8">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/result.css') }}">
</head>
<body>
    <div class="container">
        <div class="header-container" align="center">
            <div class="title">
                <h2>Result</h2>
            </div>
        </div>
        <div class="panel-container" align="center">
            <div class="panel panel-default" style="margin-left : 15px">
                <div class="panel-body">
                    <table id="myTable" class="table">
                        <tr>
                            <th class="th-header" style="width:10%;border-top:none;">No</th>
                            <th class="th-header" style="border-top:none;">Origin File</th>
                            <th class="th-header" style="border-top:none;">Compare File</th>
                            <th id="th-similarity" class="th-header" style="border-top:none;">Similarity<span id="similarity" class="glyphicon glyphicon-triangle-bottom" style="margin-left:2px;"></span></th>
                            <th id="th-modify" class="th-header" style="border-top:none;">Modified Date<span id="modifyDate" class="glyphicon glyphicon-triangle-top" style="margin-left:2px;"></span></th>
                        </tr>
                        {% for i in range(1, 21) %}
                        <tr id="row_{{i}} "style="cursor:pointer;">
                            <td id="idx_{{i}}"></td>
                            <td id="origin_{{i}}"></td>
                            <td id="comp_{{i}}"></td>
                            <td id="similarity_{{i}}"></td>
                            <td id="modify_{{i}}"></td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
        <div class="footer" align="center">
            <div id="pagination"></div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
    var simDesc_dateAsc = {{dateByAsc|safe}};
    var simDesc_dateDesc = {{dateByDesc|safe}};
    var pairCount = {{pairCount}};
    var pID = {{projectid}};
    var NUMBER_PAGE = 20;
    var pageNum = Math.ceil(pairCount / NUMBER_PAGE);
    var nowPage = 1;
    var nowList, simAsc_dateAsc, simAsc_dateDesc;
    var TOP = "glyphicon glyphicon-triangle-top";
    var BOTTOM = "glyphicon glyphicon-triangle-bottom"

    init();

    function init(){
        simAsc_dateAsc = [];
        simAsc_dateDesc = [];
        var len = simDesc_dateAsc.length;
        for(var i=len-1; i>=0; i--){
            simAsc_dateDesc.push(simDesc_dateAsc[i]);
        }
        var len = simDesc_dateDesc.length;
        for(var i=len-1; i>=0; i--){
            simAsc_dateAsc.push(simDesc_dateDesc[i]);
        }
        nowList = simDesc_dateAsc;
        update();
    }

    function parseDate(gmt){
        if(gmt == null){
            return '-';
        }
        var date = new Date(gmt);
        var temp = date.toLocaleString().split(".", 3);
        return (temp[0] + "." + temp[1] + "." + temp[2]);
    }

    function changeList(){
        if($("#similarity").attr('class') == TOP && $("#modifyDate").attr('class') == TOP){
            nowList = simAsc_dateAsc;
        }else if($("#similarity").attr('class') == TOP && $("#modifyDate").attr('class') == BOTTOM){
            nowList = simAsc_dateDesc;
        }else if($("#similarity").attr('class') == BOTTOM && $("#modifyDate").attr('class') == TOP){
            nowList = simDesc_dateAsc;
        }else{
            nowList = simDesc_dateDesc;
        }
    }

    function update(){
        changeList();
        for(var i=1; i<=NUMBER_PAGE; i++){
            var now = i + NUMBER_PAGE * (nowPage-1);
            if(now <= pairCount){
                $("#idx_"+i).css("display", "");
                $("#origin_"+i).css("display", "");
                $("#comp_"+i).css("display", "");
                $("#similarity_"+i).css("display", "");
                $("#modify_"+i).css("display", "");

                $("#idx_"+i).html(now);
                $("#origin_"+i).html(nowList[now-1].originID);
                $("#comp_"+i).html(nowList[now-1].compID);
                $("#similarity_"+i).html(nowList[now-1].similarity + ' %');
                $("#modify_"+i).html(parseDate(nowList[now-1].modifyDate));
            }else{
                $("#idx_"+i).css("display", "none");
                $("#origin_"+i).css("display", "none");
                $("#comp_"+i).css("display", "none");
                $("#similarity_"+i).css("display", "none");
                $("#modify_"+i).css("display", "none");
            }
        }
    }

    $(function(){
        $("td").on("click", function(e){
            var id = $(this).attr('id');
            var temp = id.split('_');
            var now = parseInt(temp[1]) + NUMBER_PAGE * (nowPage-1);
            window.open('/result/'+pID+'/'+nowList[now-1].pairID, 'detail', 'window settings');
        })
    });

    $("#th-similarity").click(function(){
        if($("#similarity").attr('class')==TOP)
            $("#similarity").attr('class', BOTTOM);
        else
            $("#similarity").attr('class',TOP);
        update();
    });

    $("#th-modify").click(function(){
        if($("#modifyDate").attr('class')==TOP)
            $("#modifyDate").attr('class', BOTTOM);
        else
            $("#modifyDate").attr('class', TOP);
        update();
    });

    $('#pagination').bootpag({
        total: pageNum,
        page : 1,
        maxVisible : 5,
    }).on("page", function(event, num){
        nowPage = num;
        update();
    });

</script>